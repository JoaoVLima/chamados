@baseUrl = http://localhost:5000

### ========================================
### AUTENTICAÇÃO
### ========================================

### LOGIN
@email = admin@empresa.com
@password = senha123
# @name login
GET {{baseUrl}}/users?email={{email}}&password={{password}}
###
@authToken = fake_jwt_token_{{login.response.body.$[0].username}}_{{$timestamp}}

### ========================================
### USUÁRIOS
### ========================================


### Listar todos os usuários
# @name listUsers
GET {{baseUrl}}/users
Authorization: Bearer {{authToken}}
###


### Buscar usuário por ID
# @name getUser
GET {{baseUrl}}/users/1
Authorization: Bearer {{authToken}}
###

### Buscar usuários por role
# @name getUsersByRole
GET {{baseUrl}}/users?role=tecnico
Authorization: Bearer {{authToken}}
###

### ========================================
### CHAMADOS
### ========================================


### Listar todos os chamados
# @name listChamados
GET {{baseUrl}}/chamados
Authorization: Bearer {{authToken}}
###

### Buscar chamados abertos
# @name getChamadosAbertos
GET {{baseUrl}}/chamados?status=aberto
Authorization: Bearer {{authToken}}
###

### Buscar chamados em atendimento
# @name getChamadosEmAtendimento
GET {{baseUrl}}/chamados?status=em_atendimento
Authorization: Bearer {{authToken}}
###

### Buscar chamados resolvidos
# @name getChamadosResolvidos
GET {{baseUrl}}/chamados?status=resolvido
Authorization: Bearer {{authToken}}
###

### Buscar chamados de alta prioridade
# @name getChamadosAltaPrioridade
GET {{baseUrl}}/chamados?prioridade=alta
Authorization: Bearer {{authToken}}
###

### Buscar chamados por setor
# @name getChamadosPorSetor
GET {{baseUrl}}/chamados?setor=Financeiro
Authorization: Bearer {{authToken}}
###

### Buscar chamados por usuário
# @name getChamadosPorUsuario
GET {{baseUrl}}/chamados?usuario_id=1
Authorization: Bearer {{authToken}}
###

### Buscar chamados por técnico
# @name getChamadosPorTecnico
GET {{baseUrl}}/chamados?tecnico_id=1
Authorization: Bearer {{authToken}}
###

### Criar novo chamado
# @name createChamado
POST {{baseUrl}}/chamados
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "titulo": "Problema com impressora - {{$timestamp}}",
  "descricao": "A impressora está apresentando erro de papel atolado. Já tentei remover mas o problema persiste.",
  "prioridade": "media",
  "setor": "RH",
  "status": "aberto",
  "usuario_id": 1,
  "tecnico_id": null,
  "atendente_id": null,
  "created_at": "{{$datetime iso8601}}",
  "updated_at": "{{$datetime iso8601}}",
  "resolved_at": null
}

###

@chamadoId = {{createChamado.response.body.$.id}}

### Buscar chamado criado
# @name getChamado
GET {{baseUrl}}/chamados/{{chamadoId}}
Authorization: Bearer {{authToken}}
###

### Atribuir técnico ao chamado
# @name atribuirTecnico
PATCH {{baseUrl}}/chamados/{{chamadoId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tecnico_id": 1,
  "status": "em_atendimento",
  "updated_at": "{{$datetime iso8601}}"
}

###

### Resolver chamado
# @name resolverChamado
PATCH {{baseUrl}}/chamados/{{chamadoId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "status": "resolvido",
  "resolved_at": "{{$datetime iso8601}}",
  "updated_at": "{{$datetime iso8601}}"
}

###

### Cancelar chamado
# @name cancelarChamado
PATCH {{baseUrl}}/chamados/{{chamadoId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "status": "cancelado",
  "updated_at": "{{$datetime iso8601}}"
}

###

### Atualizar prioridade do chamado
# @name atualizarPrioridade
PATCH {{baseUrl}}/chamados/{{chamadoId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "prioridade": "alta",
  "updated_at": "{{$datetime iso8601}}"
}

###

### Deletar chamado
# @name deleteChamado
DELETE {{baseUrl}}/chamados/{{chamadoId}}
Authorization: Bearer {{authToken}}
###

### ========================================
### COMENTÁRIOS
### ========================================

### Listar todos os comentários
# @name listComentarios
GET {{baseUrl}}/comentarios
Authorization: Bearer {{authToken}}
###

### Buscar comentários de um chamado
# @name getComentariosByChamado
GET {{baseUrl}}/comentarios?chamado_id={{chamadoId}}
Authorization: Bearer {{authToken}}
###

### Criar novo comentário
# @name createComentario
POST {{baseUrl}}/comentarios
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "chamado_id": {{chamadoId}},
  "usuario_id": 1,
  "texto": "Estou analisando o problema. Previsão de resolução: 30 minutos.",
  "created_at": "{{$datetime iso8601}}"
}

###

@comentarioId = {{createComentario.response.body.$.id}}


### Buscar comentário criado
# @name getComentario
GET {{baseUrl}}/comentarios/{{comentarioId}}
Authorization: Bearer {{authToken}}
###

### Atualizar comentário
# @name updateComentario
PUT {{baseUrl}}/comentarios/{{comentarioId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "id": {{comentarioId}},
  "chamado_id": {{chamadoId}},
  "usuario_id": 1,
  "texto": "Problema identificado. Iniciando correção.",
  "created_at": "{{$datetime iso8601}}"
}

###

### Deletar comentário
# @name deleteComentario
DELETE {{baseUrl}}/comentarios/{{comentarioId}}
Authorization: Bearer {{authToken}}
###

### ========================================
### PRIORIDADES
### ========================================

### Listar todas as prioridades
# @name listPrioridades
GET {{baseUrl}}/prioridades
Authorization: Bearer {{authToken}}
###

### Buscar prioridade por ID
# @name getPrioridade
GET {{baseUrl}}/prioridades/1
Authorization: Bearer {{authToken}}
###

### Buscar prioridade por nome
# @name getPrioridadeByNome
GET {{baseUrl}}/prioridades?nome=alta
Authorization: Bearer {{authToken}}
###

### ========================================
### STATUS
### ========================================

### Listar todos os status
# @name listStatus
GET {{baseUrl}}/status
Authorization: Bearer {{authToken}}
###

### Buscar status por ID
# @name getStatus
GET {{baseUrl}}/status/1
Authorization: Bearer {{authToken}}
###

### Buscar status por nome
# @name getStatusByNome
GET {{baseUrl}}/status?nome=aberto
Authorization: Bearer {{authToken}}
###

### ========================================
### QUERIES AVANÇADAS
### ========================================

### Buscar chamados ordenados por data (mais recentes)
# @name getChamadosOrdenados
GET {{baseUrl}}/chamados?_sort=created_at&_order=desc
Authorization: Bearer {{authToken}}
###

### Buscar chamados com paginação (página 1, 5 itens)
# @name getChamadosPaginados
GET {{baseUrl}}/chamados?_page=1&_limit=5
Authorization: Bearer {{authToken}}
###

### Buscar chamados com múltiplos filtros e ordenação
# @name getChamadosFiltrados
GET {{baseUrl}}/chamados?status=aberto&prioridade=alta&_sort=created_at&_order=desc
Authorization: Bearer {{authToken}}
###

### Buscar usuários ativos
# @name getUsuariosAtivos
GET {{baseUrl}}/users?is_active=true
Authorization: Bearer {{authToken}}
###

### Buscar técnicos ativos
# @name getTecnicosAtivos
GET {{baseUrl}}/users?role=tecnico&is_active=true
Authorization: Bearer {{authToken}}
###

### Buscar chamados por texto no título
# @name searchChamados
GET {{baseUrl}}/chamados?titulo_like=computador
Authorization: Bearer {{authToken}}
###

### Buscar usuários por nome (pesquisa parcial)
# @name searchUsuarios
GET {{baseUrl}}/users?first_name_like=Jo
Authorization: Bearer {{authToken}}
###

### ========================================
### WORKFLOW COMPLETO
### ========================================

### 1. Usuário cria chamado
# @name workflowStep1
POST {{baseUrl}}/chamados
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "titulo": "Workflow Test - Impressora com problema",
  "descricao": "Impressora não imprime documentos coloridos",
  "prioridade": "media",
  "setor": "Comercial",
  "status": "aberto",
  "usuario_id": 1,
  "tecnico_id": null,
  "atendente_id": null,
  "created_at": "{{$datetime iso8601}}",
  "updated_at": "{{$datetime iso8601}}",
  "resolved_at": null
}

###

@workflowChamadoId = {{workflowStep1.response.body.$.id}}

### 2. Atendente atribui técnico
# @name workflowStep2
PATCH {{baseUrl}}/chamados/{{workflowChamadoId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tecnico_id": 1,
  "atendente_id": 2,
  "status": "em_atendimento",
  "updated_at": "{{$datetime iso8601}}"
}

###

### 3. Técnico adiciona comentário
# @name workflowStep3
POST {{baseUrl}}/comentarios
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "chamado_id": {{workflowChamadoId}},
  "usuario_id": 1,
  "texto": "Verificando drivers da impressora. Problema identificado: falta cartucho colorido.",
  "created_at": "{{$datetime iso8601}}"
}

###

### 4. Técnico resolve o chamado
# @name workflowStep4
PATCH {{baseUrl}}/chamados/{{workflowChamadoId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "status": "resolvido",
  "resolved_at": "{{$datetime iso8601}}",
  "updated_at": "{{$datetime iso8601}}"
}

###

### 5. Verificar chamado resolvido com comentários
# @name workflowStep5
GET {{baseUrl}}/chamados/{{workflowChamadoId}}?_embed=comentarios
Authorization: Bearer {{authToken}}

###